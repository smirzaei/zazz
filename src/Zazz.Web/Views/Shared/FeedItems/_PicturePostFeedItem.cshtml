@using Zazz.Infrastructure
@model FeedViewModel
@{
    Layout = null;
    var photosCount = Model.PhotoViewModel.Count;
}
<div class="feed-item">
    <a href="~/user/profile/@Model.UserId">
        <img title="@Model.UserDisplayName" src="@Model.UserImageUrl" class="feed-user-img img-small-rounded" />
    </a>

    <div class="feed-content well well-small no-padding">

        @if (photosCount == 1)
        {   

            @Html.Partial("FeedItems/_PhotoFeedSinglePhoto", Model.PhotoViewModel[0])
        
            <div title="@Model.Time.ToLongDateString() - @Model.Time.ToShortTimeString()" data-placement="right"
                 class="pull-right font-verysmall" style="margin: 5px 5px 0 0;">@Model.Time.ToRelativeTime()
            </div>
            <div class="clearfix"></div>
        
        
@*<ul class="feed-options">
            <li><a href="#"><i class="icon-question-sign"></i> Option 1</a></li>
            <li><a href="#"><i class="icon-question-sign"></i> Option 2</a></li>
            <li><a href="#"><i class="icon-question-sign"></i> Option 3</a></li>
        </ul>*@
        
            <div class="clearfix" style="margin-bottom: 10px;"></div>
        
            @Html.Partial("FeedItems/_FeedComments", Model.CommentsViewModel)
        }
        else
        {
            if (photosCount == 2) // 2 photos
            {
                @Html.Partial("FeedItems/_PhotoFeedTwoPhotos",
                        new[] { Model.PhotoViewModel[0], Model.PhotoViewModel[1] })
            }
            else if (photosCount == 3) // 3 photos
            {
                @Html.Partial("FeedItems/_PhotoFeedSinglePhoto", Model.PhotoViewModel[2])
            
                @Html.Partial("FeedItems/_PhotoFeedTwoPhotos",
                        new[] { Model.PhotoViewModel[0], Model.PhotoViewModel[1] })
            }
            else // 4 and higher
            {
                if ((photosCount % 3) == 0)
                {
                    // rows of 3

                    for (var i = photosCount - 1; i >= 0; i -= 3)
                    {
                        Html.RenderPartial("FeedItems/_PhotoFeedThreePhotos", new[] {
                            Model.PhotoViewModel[i],
                            Model.PhotoViewModel[i - 1],
                            Model.PhotoViewModel[i - 2]
                        });
                    }
                }
                else if (((photosCount - 1) % 3) == 0)
                {
                    // 1 full width + rows of 3

                    Html.Partial("FeedItems/_PhotoFeedSinglePhoto", Model.PhotoViewModel.Last());

                    for (var i = photosCount - 2; i >= 0;  i -= 3)
                    {
                        Html.RenderPartial("FeedItems/_PhotoFeedThreePhotos", new[] {
                            Model.PhotoViewModel[i],
                            Model.PhotoViewModel[i - 1],
                            Model.PhotoViewModel[i - 2]
                        });
                    }
                }
                else if (((photosCount + 1)%3) == 0)
                {
                    // 2 large pics + rows of 3

                    @Html.Partial("FeedItems/_PhotoFeedTwoPhotos",
                                  new[] {Model.PhotoViewModel[photosCount - 1], Model.PhotoViewModel[photosCount - 2]})


                    for (var i = photosCount - 3; i >= 0; i -= 3)
                    {
                        Html.RenderPartial("FeedItems/_PhotoFeedThreePhotos",
                                           new[]
                                           {
                                               Model.PhotoViewModel[i],
                                               Model.PhotoViewModel[i - 1],
                                               Model.PhotoViewModel[i - 2]
                                           });
                    }
                }
            }
            
            <div class="clearfix"></div>
        }


        @foreach (var p in Model.PhotoViewModel)
        {
            @Html.Partial("_LightBoxPartial", p)
        }

    </div>
</div>

